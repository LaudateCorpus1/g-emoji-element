#!/usr/bin/env node

// Generates the modifiers.js module with a list of emoji that support
// skin tone modifiers.
//
// When new emoji are published in updated Unicode versions:
//
// 1. Add the emoji to muan/emojilib and publish a release
// 2. npm update emojilib
// 3. npm run generate-emoji
// 4. git commit -am "Update emoji list"

const emojis = require('emojilib').lib

const pluck = key => obj => obj[key]
const isFitzpatrick = pluck('fitzpatrick_scale')
const emoji = pluck('char')
const codepoints = text => [...text].map(ch => ch.codePointAt(0))
const hex = num => `0x${num.toString(16)}`
const first = pluck(0)

const points = new Set(
  Object.values(emojis)
    .filter(isFitzpatrick)
    .map(emoji)
    .map(codepoints)
    .map(first)
    .map(hex)
)

const script = `
// Generated by script/generate-emoji-modifiers.
// You MUST commit any modifications to this file.

/* @flow strict */

const points = new Set([
  ${[...points].sort().join(',')}
])

export function isModifiable(emoji: string): boolean {
  return points.has(emoji.codePointAt(0))
}
`

console.log(script)
