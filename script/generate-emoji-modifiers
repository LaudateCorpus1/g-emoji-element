#!/usr/bin/env node

// Generates the modifiers.js module with a list of emoji that support
// skin tone modifiers.
//
// When new emoji are published in updated Unicode versions:
//
// 1. Add the emoji to muan/emojilib and publish a release
// 2. npm update emojilib
// 3. npm run generate-emoji
// 4. git commit -am "Update emoji list"

const data = require('unicode-emoji-json')

const isFitzpatrick = key => data[key].fitzpatrick_scale
const codepoints = text => [...text].map(ch => ch.codePointAt(0))
const hex = points => [...points].map(num => `0x${num.toString(16)}`)
const string = hexArray => `[${[...hexArray].join(',')}]`

const points = new Set(
  Object.keys(data)
    .filter(isFitzpatrick)
    .map(codepoints)
    .map(hex)
    .map(string)
)

const script = `
// Generated by script/generate-emoji-modifiers.
// You MUST commit any modifications to this file.

/* @flow strict */

const points = new Set([
  ${[...points].sort().join(',')}
].map(arr => arr.join(',')))

function codePoints(emoji) {
  return [...emoji].map(ch => ch.codePointAt(0)).join(',')
}

export function isModifiable(emoji: string): boolean {
  return points.has(codePoints(emoji))
}
`

console.log(script)
